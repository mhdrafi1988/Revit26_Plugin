<Window x:Class="Revit26.RoofTagV42.Views.RoofTagWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:Revit26.RoofTagV42.ViewModels.Converters"
        Title="Roof Tag V42" Height="700" Width="600"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Background="#FFF5F5F5">

    <Window.Resources>
        <converters:BoolInverseConverter x:Key="BoolInverseConverter" />
        <converters:BoolToButtonTextConverter x:Key="BoolToButtonTextConverter" />
        <converters:BoolToButtonColorConverter x:Key="BoolToButtonColorConverter" />
        <converters:BoolToStatusConverter x:Key="BoolToStatusConverter" />

        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="0,0,0,8" />
            <Setter Property="Padding" Value="8" />
            <Setter Property="BorderBrush" Value="#FF007ACC" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Background" Value="#FFFFFFFF" />
        </Style>

        <Style TargetType="Button">
            <Setter Property="Margin" Value="5" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="MinWidth" Value="80" />
            <Setter Property="Background" Value="#FF007ACC" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#FF005A9E" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <Style TargetType="TextBlock">
            <Setter Property="Margin" Value="5,3" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="FontSize" Value="12" />
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="5,3" />
            <Setter Property="Padding" Value="4" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#FFCCCCCC" />
        </Style>

        <Style TargetType="CheckBox">
            <Setter Property="Margin" Value="5,3" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style TargetType="RadioButton">
            <Setter Property="Margin" Value="5,3" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style TargetType="ComboBox">
            <Setter Property="Margin" Value="5,3" />
            <Setter Property="Padding" Value="4" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>

        <Style TargetType="Slider">
            <Setter Property="Margin" Value="5,3" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <!-- Status Text Style -->
        <Style x:Key="StatusTextStyle" TargetType="TextBlock">
            <Setter Property="Margin" Value="5,3" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding UseManualMode}" Value="True">
                    <Setter Property="Foreground" Value="#FF2E8B57" />
                    <!-- Green -->
                </DataTrigger>
                <DataTrigger Binding="{Binding UseManualMode}" Value="False">
                    <Setter Property="Foreground" Value="#FF007ACC" />
                    <!-- Blue -->
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Mode Selection -->
        <GroupBox Grid.Row="0" Header="Selection Mode">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <RadioButton Content="Automatic (Use Roof Vertices)" 
                               IsChecked="{Binding UseManualMode, Converter={StaticResource BoolInverseConverter}, Mode=TwoWay}"
                               GroupName="SelectionMode"/>
                    <TextBlock Text="Tags will be placed at all roof vertices"
                               Margin="20,2,0,0"
                               FontSize="11"
                               Foreground="#FF666666"/>
                </StackPanel>

                <StackPanel Grid.Column="1">
                    <RadioButton Content="Manual (Select Points)" 
                               IsChecked="{Binding UseManualMode, Mode=TwoWay}"
                               GroupName="SelectionMode"/>
                    <TextBlock Text="Select specific points on roof surface"
                               Margin="20,2,0,0"
                               FontSize="11"
                               Foreground="#FF666666"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Manual Selection Controls -->
        <GroupBox Grid.Row="1" Header="Manual Point Selection" 
                  Visibility="{Binding UseManualMode, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Selection Button -->
                <Button Grid.Row="0" Grid.Column="0"
                        Content="{Binding ManualModeButtonText}"
                        Command="{Binding SelectManualPointsCommand}"
                        Width="150"
                        Height="35"
                        Margin="0,0,10,5"
                        Background="#FF2E8B57"
                        BorderBrush="#FF228B22">
                    <Button.ToolTip>
                        <TextBlock>
                            Click to select points on roof surface
                            <LineBreak/>
                            • Click on roof to add points
                            <LineBreak/>
                            • Press ESC when finished
                            <LineBreak/>
                            • Points are projected to roof surface
                        </TextBlock>
                    </Button.ToolTip>
                </Button>

                <!-- Status Text -->
                <TextBlock Grid.Row="0" Grid.Column="1"
                           Text="{Binding ManualModeStatusText}"
                           Style="{StaticResource StatusTextStyle}"
                           VerticalAlignment="Center"/>

                <!-- Clear Button -->
                <Button Grid.Row="0" Grid.Column="2"
                        Content="Clear Points"
                        Command="{Binding ClearManualPointsCommand}"
                        Width="100"
                        Height="35"
                        Background="#FFDC143C"
                        BorderBrush="#FFB22222"
                        ToolTip="Clear all manually selected points">
                </Button>

                <!-- Instructions -->
                <TextBlock Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
                           Text="Instructions: Click 'Select Points' then click on roof surface. Press ESC when finished."
                           FontSize="11"
                           Foreground="#FF666666"
                           Margin="0,5,0,0"/>
            </Grid>
        </GroupBox>

        <!-- Tag Settings -->
        <GroupBox Grid.Row="2" Header="Tag Settings">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Grid.Column="0">
                    <CheckBox Content="Use Leader" 
                              IsChecked="{Binding UseLeader}" 
                              Margin="0,2"/>
                    <CheckBox Content="Bend Inward" 
                              IsChecked="{Binding BendInward}" 
                              Margin="0,2"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="1" Margin="10,0,0,0">
                    <TextBlock Text="Tag Type:" Margin="0,2"/>
                    <ComboBox ItemsSource="{Binding SpotTagTypes}"
                              SelectedItem="{Binding SelectedSpotTagType}"
                              DisplayMemberPath="Name"
                              Height="28"/>
                </StackPanel>

                <!-- Settings Info -->
                <TextBlock Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                           Text="Bend Inward: Leader bends toward roof center. Bend Outward: Leader bends away from roof."
                           FontSize="11"
                           Foreground="#FF666666"
                           Margin="0,8,0,0"/>
            </Grid>
        </GroupBox>

        <!-- Offset Settings -->
        <GroupBox Grid.Row="3" Header="Leader Settings">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="60"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Bend Offset -->
                <TextBlock Text="Bend Offset (mm):" 
                           Grid.Row="0" Grid.Column="0"
                           Margin="5,5,15,5"/>

                <Slider Grid.Row="0" Grid.Column="1" 
                       Minimum="0" Maximum="5000" 
                       Value="{Binding BendOffsetMillimeters}"
                       TickFrequency="100" 
                       TickPlacement="BottomRight"
                       Margin="5,5,10,5"
                       ToolTip="Distance from point to leader bend"/>

                <TextBlock Grid.Row="0" Grid.Column="2" 
                          Text="{Binding BendOffsetMillimeters, StringFormat={}{0:F0}}"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Center"
                          Margin="0,5,5,5"/>

                <!-- End Offset -->
                <TextBlock Text="End Offset (mm):" 
                           Grid.Row="1" Grid.Column="0"
                           Margin="5,5,15,5"/>

                <Slider Grid.Row="1" Grid.Column="1" 
                       Minimum="0" Maximum="10000" 
                       Value="{Binding EndOffsetMillimeters}"
                       TickFrequency="100" 
                       TickPlacement="BottomRight"
                       Margin="5,5,10,5"
                       ToolTip="Distance from bend to tag text"/>

                <TextBlock Grid.Row="1" Grid.Column="2" 
                          Text="{Binding EndOffsetMillimeters, StringFormat={}{0:F0}}"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Center"
                          Margin="0,5,5,5"/>

                <!-- Angle -->
                <TextBlock Text="Angle (°):" 
                           Grid.Row="2" Grid.Column="0"
                           Margin="5,5,15,5"/>

                <Slider Grid.Row="2" Grid.Column="1" 
                       Minimum="0" Maximum="180" 
                       Value="{Binding SelectedAngle}"
                       TickFrequency="15" 
                       TickPlacement="BottomRight"
                       Margin="5,5,10,5"
                       ToolTip="Angle of leader end segment (0°=horizontal, 90°=vertical, 45°=diagonal)"/>

                <TextBlock Grid.Row="2" Grid.Column="2" 
                          Text="{Binding SelectedAngle, StringFormat={}{0:F0}°}"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Center"
                          Margin="0,5,5,5"/>
            </Grid>
        </GroupBox>

        <!-- Log Area -->
        <GroupBox Grid.Row="4" Header="Execution Log">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Log TextBox -->
                <TextBox x:Name="LogTextBox" 
                        Grid.Row="0"
                        Text="{Binding LogText, Mode=OneWay}"
                        IsReadOnly="True" 
                        VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Auto"
                        TextWrapping="Wrap"
                        FontFamily="Consolas"
                        FontSize="11"
                        Background="#FF1E1E1E"
                        Foreground="#FFF0F0F0"
                        BorderThickness="1"
                        BorderBrush="#FF007ACC"
                        Margin="5"
                        AcceptsReturn="True"
                        VerticalContentAlignment="Top"
                        HorizontalContentAlignment="Left"
                        ToolTip="Execution log - shows all operations and results"/>

                <!-- Log Controls -->
                <Border Grid.Row="1" 
                        Background="#FFF0F0F0"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="0,1,0,0"
                        Padding="5">
                    <StackPanel Orientation="Horizontal" 
                                HorizontalAlignment="Right">
                        <CheckBox Content="Auto-scroll" 
                                IsChecked="{Binding AutoScroll}" 
                                Margin="5,0,10,0"
                                VerticalAlignment="Center"
                                ToolTip="Automatically scroll to latest log entry"/>

                        <Button Content="Test Settings" 
                                Command="{Binding TestSettingsCommand}" 
                                Margin="0,0,5,0"
                                Width="100"
                                ToolTip="Log current settings to console"/>

                        <Button Content="Clear Log" 
                                Command="{Binding ClearLogCommand}" 
                                Margin="0,0,5,0"
                                Width="90"
                                ToolTip="Clear the log window"/>

                        <Button Content="Copy Log" 
                                Click="CopyLog_Click"
                                Margin="0,0,5,0"
                                Width="90"
                                ToolTip="Copy log to clipboard"/>
                    </StackPanel>
                </Border>
            </Grid>
        </GroupBox>

        <!-- Action Buttons -->
        <Border Grid.Row="5" 
                Background="#FFF0F0F0"
                BorderBrush="#FFCCCCCC"
                BorderThickness="0,1,0,0"
                Margin="0,12,0,0"
                Padding="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Status Area -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="{Binding IsProcessing, Converter={StaticResource BoolToStatusConverter}}"
                               Margin="10,0"
                               VerticalAlignment="Center"
                               Foreground="#FF007ACC"
                               FontWeight="SemiBold"/>

                    <TextBlock Text="{Binding ManualModeStatusText}"
                               Margin="20,0,0,0"
                               VerticalAlignment="Center"
                               Foreground="#FF2E8B57"
                               FontWeight="SemiBold"
                               Visibility="{Binding UseManualMode, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="CancelButton" 
                            Content="Close" 
                            Width="90" 
                            Height="35"
                            Click="OnCancelClicked"
                            IsEnabled="{Binding IsNotProcessing}"
                            ToolTip="Close the window"
                            Background="#FF6C757D"
                            BorderBrush="#FF495057">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsProcessing}" Value="True">
                                        <Setter Property="ToolTip" Value="Operation in progress. Please wait..."/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Button x:Name="OkButton" 
                            Content="{Binding IsProcessing, Converter={StaticResource BoolToButtonTextConverter}}"
                            Width="120" 
                            Height="35"
                            Command="{Binding ExecuteTaggingCommand}"
                            IsEnabled="{Binding IsNotProcessing}"
                            Background="{Binding IsProcessing, Converter={StaticResource BoolToButtonColorConverter}}"
                            Margin="10,0,0,0"
                            ToolTip="Start tagging operation with current settings">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsProcessing}" Value="True">
                                        <Setter Property="Background" Value="#FF2B91AF"/>
                                        <Setter Property="Cursor" Value="Wait"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>