<Window x:Class="Revit26_Plugin.APUS_V314.Views.AutoPlaceSectionsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Revit26_Plugin.APUS_V314.Views"
        xmlns:converters="clr-namespace:Revit26_Plugin.APUS_V314.Converters"
        xmlns:viewModels="clr-namespace:Revit26_Plugin.APUS_V314.ViewModels"
        xmlns:models="clr-namespace:Revit26_Plugin.APUS_V314.Models"
        Title="APUS V314 - Auto Place Sections"
        Height="950" Width="1300"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        MinHeight="800" MinWidth="1200">

    <Window.Resources>
        <!-- Converters -->
        <converters:PluginStateConverter x:Key="StateConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:LogLevelToBrushConverter x:Key="LogColorConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter" TrueColor="Green" FalseColor="Gray"/>
        <converters:AlgorithmDescriptionConverter x:Key="AlgorithmDescriptionConverter"/>
        <converters:ViewSizeConverter x:Key="ViewSizeConverter"/>
        <converters:PlacementAlgorithmConverter x:Key="PlacementAlgorithmConverter"/>

        <!-- Style for GroupBox headers -->
        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
        </Style>

        <!-- Style for TextBox -->
        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="0,2,0,5"/>
            <Setter Property="Padding" Value="3"/>
            <Setter Property="MinHeight" Value="24"/>
        </Style>

        <!-- Style for ComboBox -->
        <Style TargetType="ComboBox">
            <Setter Property="Margin" Value="0,2,0,5"/>
            <Setter Property="Padding" Value="3"/>
            <Setter Property="MinHeight" Value="26"/>
        </Style>

        <!-- Style for Buttons -->
        <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
            <Setter Property="Margin" Value="5,0,0,0"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>

        <!-- Style for Status Indicator -->
        <Style x:Key="StatusIndicatorStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header/Status -->
            <RowDefinition Height="Auto"/>
            <!-- Quick Controls -->
            <RowDefinition Height="*"/>
            <!-- Main Content -->
            <RowDefinition Height="220"/>
            <!-- Log/Progress -->
        </Grid.RowDefinitions>

        <!-- ================= HEADER / STATUS BAR ================= -->
        <Border Grid.Row="0" Background="#F5F5F5" BorderBrush="#DDDDDD" BorderThickness="0,0,0,1" 
                Padding="10,8" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title and Status -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="📐" FontSize="24" Margin="0,0,10,0"/>
                    <TextBlock Text="APUS V314 - Auto Place Sections" 
                               FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>

                    <TextBlock Text="•" Margin="15,0,10,0" FontSize="20" VerticalAlignment="Center"/>

                    <!-- Status Indicator -->
                    <Border Style="{StaticResource StatusIndicatorStyle}" 
                            Background="{Binding CurrentState, Converter={StaticResource StateConverter}, ConverterParameter=StatusColor}">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse Width="8" Height="8" Margin="0,0,5,0"
                                     Fill="{Binding CurrentState, Converter={StaticResource StateConverter}, ConverterParameter=StatusDotColor}"/>
                            <TextBlock Text="{Binding CurrentState}" 
                                       FontWeight="SemiBold"
                                       Foreground="White"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Quick Actions -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Refresh Data" 
                            Command="{Binding RefreshCommand}"
                            ToolTip="Reload sections and title blocks"
                            IsEnabled="True"/>

                    <Button Content="Select All" 
                            Command="{Binding SelectAllCommand}"
                            ToolTip="Select all filtered sections"
                            IsEnabled="True"/>

                    <Button Content="Clear Selection" 
                            Command="{Binding ClearSelectionCommand}"
                            ToolTip="Clear all selections"
                            IsEnabled="True"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ================= QUICK CONTROLS ================= -->
        <Border Grid.Row="1" BorderBrush="#EEEEEE" BorderThickness="0,0,0,1" Padding="0,0,0,10" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Selected Count -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Selected: " FontWeight="Bold"/>
                    <TextBlock Text="{Binding FilteredSections.Count, StringFormat={}{0} sections}"/>
                    <TextBlock Text=" | " Margin="5,0"/>
                    <TextBlock Text="{Binding SelectedSectionsCount, StringFormat={}{0} selected}" 
                               Foreground="Blue" FontWeight="Bold"/>
                </StackPanel>

                <!-- Quick Filters -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <ComboBox ItemsSource="{Binding PlacementScopes}" 
                              SelectedItem="{Binding SelectedPlacementScope}"
                              Width="180" ToolTip="Filter by Placement Scope"
                              IsEnabled="True"/>

                    <ComboBox ItemsSource="{Binding PlacementStates}" 
                              SelectedItem="{Binding SelectedPlacementState}"
                              Width="150" Margin="10,0,0,0" ToolTip="Filter by Placement State"
                              IsEnabled="True"/>

                    <ComboBox ItemsSource="{Binding SheetNumberOptions}" 
                              SelectedItem="{Binding SheetNumberFilter}"
                              Width="150" Margin="10,0,0,0" ToolTip="Filter by Sheet Number"
                              IsEnabled="True"/>
                </StackPanel>

                <!-- Algorithm Selection -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Algorithm: " FontWeight="Bold" Margin="0,0,5,0"/>
                    <ComboBox ItemsSource="{Binding AvailableAlgorithms}" 
                              SelectedItem="{Binding SelectedAlgorithm}"
                              Width="150" ToolTip="Select placement algorithm"
                              IsEnabled="True"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ================= MAIN CONTENT AREA ================= -->
        <Grid Grid.Row="2" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <!-- Sections List -->
                <ColumnDefinition Width="2*"/>
                <!-- Settings Panel -->
            </Grid.ColumnDefinitions>

            <!-- LEFT PANEL: Sections List -->
            <Border Grid.Column="0" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="4" Margin="0,0,5,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- List Header -->
                    <Border Grid.Row="0" Background="#F8F8F8" BorderBrush="#DDDDDD" BorderThickness="0,0,0,1" 
                            Padding="10,5">
                        <TextBlock Text="Available Sections" FontWeight="Bold" FontSize="14"/>
                    </Border>

                    <!-- DataGrid -->
                    <DataGrid Grid.Row="1" 
                              ItemsSource="{Binding FilteredSections}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              SelectionMode="Extended"
                              IsReadOnly="True"
                              IsEnabled="True"
                              SelectionUnit="FullRow"
                              GridLinesVisibility="Horizontal"
                              RowDetailsVisibilityMode="Collapsed"
                              VirtualizingStackPanel.IsVirtualizing="True"
                              VirtualizingStackPanel.VirtualizationMode="Recycling"
                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                              ScrollViewer.HorizontalScrollBarVisibility="Auto">

                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Width="40" 
                                                    Binding="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    Header="✓"/>

                            <DataGridTextColumn Header="Section Name" 
                                                Binding="{Binding ViewName}" 
                                                Width="2*"
                                                IsReadOnly="True"/>

                            <DataGridTextColumn Header="Scope" 
                                                Binding="{Binding PlacementScope}" 
                                                Width="120"
                                                IsReadOnly="True"/>

                            <DataGridTextColumn Header="Scale" 
                                                Binding="{Binding Scale, StringFormat=1:{0}}" 
                                                Width="80"
                                                IsReadOnly="True"/>

                            <DataGridTextColumn Header="Sheet" 
                                                Binding="{Binding SheetNumber}" 
                                                Width="100"
                                                IsReadOnly="True">
                                <DataGridTextColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Foreground">
                                            <Setter.Value>
                                                <Binding Path="IsPlaced">
                                                    <Binding.Converter>
                                                        <converters:BoolToColorConverter TrueColor="Green" FalseColor="Gray"/>
                                                    </Binding.Converter>
                                                </Binding>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </DataGridTextColumn.CellStyle>
                            </DataGridTextColumn>

                            <DataGridCheckBoxColumn Header="Placed" 
                                                    Width="70"
                                                    Binding="{Binding IsPlaced, Mode=OneWay}" 
                                                    IsReadOnly="True"/>

                            <DataGridTemplateColumn Header="Size" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding View, Converter={StaticResource ViewSizeConverter}}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>

                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Setter Property="BorderBrush" Value="Transparent"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsPlaced}" Value="True">
                                        <Setter Property="Background" Value="#F0F8FF"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="Background" Value="#E3F2FD"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>
                </Grid>
            </Border>

            <!-- RIGHT PANEL: Settings -->
            <Border Grid.Column="1" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="4" Margin="5,0,0,0">
                <TabControl TabStripPlacement="Top" BorderThickness="0">

                    <!-- TAB 1: Title Block & Layout -->
                    <TabItem Header="Layout">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="5">
                            <StackPanel>
                                <!-- Title Block Selection -->
                                <GroupBox Header="Title Block">
                                    <ComboBox ItemsSource="{Binding TitleBlocks}" 
                                              SelectedItem="{Binding SelectedTitleBlock}"
                                              DisplayMemberPath="DisplayName"
                                              IsEnabled="True"/>
                                </GroupBox>

                                <!-- Sheet Margins -->
                                <GroupBox Header="Sheet Margins (mm)">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <StackPanel Grid.Row="0" Grid.Column="0">
                                            <TextBlock Text="Left Margin"/>
                                            <TextBox Text="{Binding LeftMarginMm, UpdateSourceTrigger=PropertyChanged}"
                                                     IsEnabled="True"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="0" Grid.Column="1" Margin="10,0,0,0">
                                            <TextBlock Text="Right Margin"/>
                                            <TextBox Text="{Binding RightMarginMm, UpdateSourceTrigger=PropertyChanged}"
                                                     IsEnabled="True"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="1" Grid.Column="0">
                                            <TextBlock Text="Top Margin"/>
                                            <TextBox Text="{Binding TopMarginMm, UpdateSourceTrigger=PropertyChanged}"
                                                     IsEnabled="True"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="10,0,0,0">
                                            <TextBlock Text="Bottom Margin"/>
                                            <TextBox Text="{Binding BottomMarginMm, UpdateSourceTrigger=PropertyChanged}"
                                                     IsEnabled="True"/>
                                        </StackPanel>
                                    </Grid>
                                </GroupBox>

                                <!-- Gaps & Tolerance -->
                                <GroupBox Header="Spacing &amp; Tolerance (mm)">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="Horizontal Gap"/>
                                            <TextBox Text="{Binding HorizontalGapMm, UpdateSourceTrigger=PropertyChanged}"
                                                     IsEnabled="True"/>

                                            <TextBlock Text="Vertical Gap"/>
                                            <TextBox Text="{Binding VerticalGapMm, UpdateSourceTrigger=PropertyChanged}"
                                                     IsEnabled="True"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                            <TextBlock Text="Y Tolerance"/>
                                            <TextBox Text="{Binding YToleranceMm, UpdateSourceTrigger=PropertyChanged}"
                                                     ToolTip="Grouping tolerance for spatial sorting"
                                                     IsEnabled="True"/>

                                            <CheckBox Content="Open sheets after placement" 
                                                      IsChecked="{Binding OpenSheetsAfterPlacement}"
                                                      Margin="0,15,0,0"
                                                      IsEnabled="True"/>
                                        </StackPanel>
                                    </Grid>
                                </GroupBox>

                                <!-- Advanced Options (Collapsible) -->
                                <Expander Header="Advanced Options" Margin="0,10,0,0" IsExpanded="False">
                                    <StackPanel>
                                        <CheckBox Content="Maintain aspect ratio" 
                                                  IsChecked="{Binding MaintainAspectRatio}"
                                                  Margin="0,5"/>
                                        <CheckBox Content="Allow rotation" 
                                                  IsChecked="{Binding AllowRotation}"
                                                  Margin="0,5"/>
                                        <CheckBox Content="Create backup sheets" 
                                                  IsChecked="{Binding CreateBackupSheets}"
                                                  Margin="0,5"/>
                                        <CheckBox Content="Skip already placed views" 
                                                  IsChecked="{Binding SkipPlacedViews}"
                                                  Margin="0,5"/>
                                    </StackPanel>
                                </Expander>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- TAB 2: Algorithm Settings -->
                    <TabItem Header="Algorithm">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="5">
                            <StackPanel>
                                <GroupBox Header="Placement Algorithm">
                                    <StackPanel>
                                        <ComboBox ItemsSource="{Binding AvailableAlgorithms}" 
                                                  SelectedItem="{Binding SelectedAlgorithm}"
                                                  IsEnabled="True"/>

                                        <TextBlock Text="{Binding SelectedAlgorithm, Converter={StaticResource AlgorithmDescriptionConverter}}" 
                                                   Margin="0,10,0,0" TextWrapping="Wrap" FontStyle="Italic"
                                                   Foreground="#666666"/>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- TAB 3: Summary -->
                    <TabItem Header="Summary">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="5">
                            <StackPanel>
                                <GroupBox Header="Placement Summary">
                                    <StackPanel>
                                        <TextBlock Text="{Binding SelectedSectionsCount, StringFormat=Selected Sections: {0}}"
                                                   FontWeight="Bold" Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding EstimatedSheets, StringFormat=Estimated Sheets: {0}}"
                                                   Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding EstimatedTime, StringFormat=Estimated Time: {0} seconds}"
                                                   Margin="0,0,0,5"/>
                                        <TextBlock Text="Layout Efficiency: 85%" 
                                                   Margin="0,0,0,5" Foreground="Green"/>
                                    </StackPanel>
                                </GroupBox>

                                <Button Content="Generate Report" 
                                        Margin="0,10,0,0"
                                        IsEnabled="True"/>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
            </Border>
        </Grid>

        <!-- ================= FOOTER: LOG & CONTROLS ================= -->
        <Border Grid.Row="3" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Progress/Buttons -->
                    <RowDefinition Height="*"/>
                    <!-- Log Area -->
                </Grid.RowDefinitions>

                <!-- Progress and Action Buttons -->
                <Border Grid.Row="0" Background="#F9F9F9" BorderBrush="#DDDDDD" BorderThickness="0,0,0,1" 
                        Padding="10,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Progress Section -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <!-- Progress Bar -->
                            <ProgressBar Value="{Binding Progress.Current, Mode=OneWay}" 
             Maximum="{Binding Progress.Total, Mode=OneWay}" 
             Width="300" Height="20"
             Visibility="{Binding ShowProgress, Converter={StaticResource BoolToVis}}">
                                <ProgressBar.Style>
                                    <Style TargetType="ProgressBar">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding CurrentState}" Value="Processing">
                                                <Setter Property="Foreground" Value="#4CAF50"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding CurrentState}" Value="Cancelling">
                                                <Setter Property="Foreground" Value="#FF9800"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ProgressBar.Style>
                            </ProgressBar>

                            <!-- Progress Text -->
                            <TextBlock Text="{Binding Progress.Current, StringFormat=Progress: {0}/{1}, Mode=OneWay}" 
           Margin="10,0,0,0" VerticalAlignment="Center"
           Visibility="{Binding ShowProgress, Converter={StaticResource BoolToVis}}"/>

                            <!-- Status Messages -->
                            <TextBlock Text="{Binding StatusMessage}" 
                                       Margin="20,0,0,0" VerticalAlignment="Center"
                                       Foreground="#666666" FontStyle="Italic"/>
                        </StackPanel>

                        <!-- Action Buttons -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <!-- Place Button -->
                            <Button Content="🚀 Start Placement" 
                                    Command="{Binding PlaceCommand}"
                                    Background="#4CAF50" Foreground="White" FontWeight="Bold"
                                    ToolTip="Start placing selected sections"
                                    IsEnabled="True">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                        <Setter Property="Background" Value="#4CAF50"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Setter Property="IsEnabled" Value="True"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding CurrentState}" Value="Processing">
                                                <Setter Property="Background" Value="#FF9800"/>
                                                <Setter Property="Content" Value="⏳ Processing..."/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding CurrentState}" Value="Completed">
                                                <Setter Property="Background" Value="#2196F3"/>
                                                <Setter Property="Content" Value="✅ Place Again"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>

                            <!-- Cancel Button -->
                            <Button Content="✕ Cancel" 
                                    Command="{Binding CancelCommand}"
                                    Background="#F44336" Foreground="White"
                                    ToolTip="Cancel current operation"
                                    Visibility="{Binding ShowCancelButton, Converter={StaticResource BoolToVis}}"
                                    IsEnabled="True"/>

                            <!-- Close Button -->
                            <Button Content="Close" 
                                    Click="CloseButton_Click"
                                    Margin="10,0,0,0"
                                    IsEnabled="True"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Log Display Area -->
                <Grid Grid.Row="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Log Header -->
                    <Border Grid.Row="0" Background="#F0F0F0" BorderBrush="#DDDDDD" BorderThickness="0,0,0,1" 
                            Padding="10,5">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Live Log" FontWeight="Bold"/>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Content="Clear Log" 
                                        Command="{Binding ClearLogCommand}"
                                        ToolTip="Clear all log entries"
                                        Style="{StaticResource {x:Type Button}}" 
                                        Background="Transparent" BorderThickness="0"
                                        Padding="5,2"
                                        IsEnabled="True"/>
                                <Button Content="Export Log" 
                                        Command="{Binding ExportLogCommand}"
                                        ToolTip="Export log to file"
                                        Style="{StaticResource {x:Type Button}}" 
                                        Background="Transparent" BorderThickness="0"
                                        Padding="5,2"
                                        IsEnabled="True"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Log ListBox -->
                    <TextBox Grid.Row="1" 
         Text="{Binding LogText, Mode=OneWay}"
         IsReadOnly="True"
         IsReadOnlyCaretVisible="True"
         AcceptsReturn="True"
         AcceptsTab="True"
         VerticalScrollBarVisibility="Auto"
         HorizontalScrollBarVisibility="Auto"
         FontFamily="Consolas"
         FontSize="12"
         BorderThickness="0"
         Background="White">
                        <TextBox.ContextMenu>
                            <ContextMenu>
                                <MenuItem Command="ApplicationCommands.Copy" />
                                <MenuItem Command="ApplicationCommands.SelectAll" />
                                <Separator />
                                <MenuItem Header="Clear Log" Command="{Binding ClearLogCommand}" />
                            </ContextMenu>
                        </TextBox.ContextMenu>
                    </TextBox>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>