<Window x:Class="Revit22_Plugin.SectionPlacer.MVVM.AutoPlaceSectionsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Auto Place Sections"
        Height="720" Width="1060"
        ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        WindowStyle="ToolWindow"
        MinWidth="880" MinHeight="560">

    <Window.Resources>
        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="4"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="MinWidth" Value="70"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Margin" Value="4"/>
            <Setter Property="MinWidth" Value="220"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Padding" Value="8,4"/>
        </Style>
        <Style TargetType="DataGrid">
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="SelectionMode" Value="Extended"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="Margin" Value="6"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- 0: title block & margins -->
            <RowDefinition Height="Auto"/>
            <!-- 1: spacing & title band -->
            <RowDefinition Height="Auto"/>
            <!-- 2: filter & selection -->
            <RowDefinition Height="*"/>
            <!-- 3: sections grid -->
            <RowDefinition Height="Auto"/>
            <!-- 4: actions + status -->
        </Grid.RowDefinitions>

        <!-- Row 0: Title block & sheet margins -->
        <Border Grid.Row="0" Padding="8" Background="#F4F6F8" BorderBrush="#E0E3E6" BorderThickness="0,0,0,1">
            <DockPanel LastChildFill="True">

                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                    <TextBlock Text="Title Block:" VerticalAlignment="Center" Margin="0,0,6,0" FontWeight="SemiBold"/>
                    <ComboBox ItemsSource="{Binding TitleBlocks}"
                              SelectedItem="{Binding SelectedTitleBlock}"
                              DisplayMemberPath="Name"
                              Width="280"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <TextBlock Text="Sheet Margin (mm):" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox Text="{Binding MarginMm, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}" Width="80"/>

                    <TextBlock Text="Right Reserved (mm):" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox Text="{Binding ReservedRightMm, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}" Width="90"/>
                </StackPanel>

            </DockPanel>
        </Border>

        <!-- Row 1: Spacing between sections + bottom title band -->
        <Border Grid.Row="1" Padding="8" Background="#FFFFFF" BorderBrush="#E0E3E6" BorderThickness="0,0,0,1">
            <DockPanel LastChildFill="True">
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                    <TextBlock Text="H Spacing (mm):" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox Text="{Binding HSpacingMm, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}" Width="80"/>
                    <TextBlock Text="V Spacing (mm):" VerticalAlignment="Center" Margin="12,0,4,0"/>
                    <TextBox Text="{Binding VSpacingMm, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}" Width="80"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center">
                    <TextBlock Text="Title Gap (mm):" VerticalAlignment="Center" Margin="0,0,4,0" ToolTip="Gap between section annotation crop and title"/>
                    <TextBox Text="{Binding TitleGapMm, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}" Width="80"/>
                    <TextBlock Text="Title Height (mm):" VerticalAlignment="Center" Margin="12,0,4,0" ToolTip="Height of the title band under each section"/>
                    <TextBox Text="{Binding TitleBandMm, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}" Width="80"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Row 2: Filter + selection helpers -->
        <Border Grid.Row="2" Padding="8" Background="#FFFFFF" BorderBrush="#E0E3E6" BorderThickness="0,0,0,1">
            <DockPanel LastChildFill="True">
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                    <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBox Width="300" Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}" ToolTip="Filter by section name"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center">
                    <Button Content="Select All"   Command="{Binding SelectAllCommand}"/>
                    <Button Content="Select None"  Command="{Binding SelectNoneCommand}"/>
                    <Button Content="Reverse"      Command="{Binding ReverseCommand}"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Row 3: Sections grid -->
        <Grid Grid.Row="3">
            <DataGrid ItemsSource="{Binding Sections}">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="✔" Width="48">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Section Name" Binding="{Binding Name}" Width="*"/>
                    <DataGridTextColumn Header="Scale" Binding="{Binding Scale}" Width="120"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!-- Row 4: Actions + status -->
        <Border Grid.Row="4" Padding="8" Background="#F9FAFB" BorderBrush="#E0E3E6" BorderThickness="0,1,0,0">
            <DockPanel LastChildFill="True">
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                    <Button Content="Place Sections" Command="{Binding PlaceCommand}" FontWeight="Bold" Padding="14,6"/>
                </StackPanel>
                <TextBlock DockPanel.Dock="Right" Text="{Binding StatusText}" VerticalAlignment="Center" Foreground="#555" FontStyle="Italic"/>
            </DockPanel>
        </Border>
    </Grid>
</Window>
