<Window x:Class="Revit22_Plugin.SectionManagerMVVM_Refactored.SectionsListWindowRefactored"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:primitives="clr-namespace:System.Windows.Controls.Primitives;assembly=PresentationFramework"
        Title="Refactored Section Manager"
        Height="600"
        Width="850"
        WindowStartupLocation="CenterScreen">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Sheet Filter -->
        <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="Sheet Filter:" VerticalAlignment="Center" Margin="0,0,5,0"/>
            <ComboBox x:Name="SheetFilterCombo"
          Width="150"
          IsEditable="True"
          IsTextSearchEnabled="False"
          StaysOpenOnEdit="True"
          Loaded="SheetFilterCombo_Loaded"
          SelectionChanged="SheetFilterCombo_SelectionChanged"/>
        </StackPanel>

        <!-- Naming Controls -->
        <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,10" HorizontalAlignment="Left">

            <StackPanel Orientation="Vertical" Margin="5">
                <TextBlock Text="Prefix"/>
                <TextBox Width="100" Text="{Binding PrefixText, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>

            <StackPanel Orientation="Vertical" Margin="5">
                <TextBlock Text="Postfix"/>
                <TextBox Width="100" Text="{Binding PostfixText, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>

            <StackPanel Orientation="Vertical" Margin="5">
                <TextBlock Text="Find"/>
                <TextBox Width="100" Text="{Binding FindText, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>

            <StackPanel Orientation="Vertical" Margin="5">
                <TextBlock Text="Replace"/>
                <TextBox Width="100" Text="{Binding ReplaceText, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>

            <StackPanel Orientation="Vertical" Margin="5">
                <TextBlock Text="Serial Format"/>
                <TextBox Width="60" Text="{Binding SerialFormat, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>

            <StackPanel Orientation="Vertical" Margin="5">
                <CheckBox Content="Add Serial"
                          IsChecked="{Binding AddSerial}"
                          VerticalAlignment="Bottom"/>
                <CheckBox Content="Include Detail #"
                          IsChecked="{Binding IncludeDetailNumber}"
                          VerticalAlignment="Bottom"/>
            </StackPanel>

        </StackPanel>

        <!-- Common Name -->
        <GroupBox Header="Set Common Name for All (Filtered)" Grid.Row="2" Margin="0,0,0,10">
            <TextBox Text="{Binding CommonEditName, UpdateSourceTrigger=PropertyChanged}"
                     Height="30"
                     FontSize="14"
                     Margin="5"
                     VerticalContentAlignment="Center"/>
        </GroupBox>

        <!-- DataGrid -->
        <DataGrid x:Name="SectionsDataGrid"
                  Grid.Row="3"
                  AutoGenerateColumns="False"
                  ItemsSource="{Binding Sections}"
                  CanUserAddRows="False"
                  HeadersVisibility="Column"
                  Margin="0,0,0,10"
                  SelectionMode="Extended"
                  SelectionUnit="FullRow">

            <DataGrid.Columns>

                <DataGridTextColumn Header="Serial"
                                    Binding="{Binding Serial}"
                                    Width="60"
                                    IsReadOnly="True"/>

                <DataGridTextColumn Header="Original Name"
                                    Binding="{Binding OriginalName}"
                                    Width="*"
                                    IsReadOnly="True"/>

                <!-- Editable Name with green background -->
                <DataGridTextColumn Header="Editable Name"
                                    Binding="{Binding EditableName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Background" Value="LightGreen"/>
                            <Setter Property="Padding" Value="2"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.EditingElementStyle>
                        <Style TargetType="TextBox">
                            <Setter Property="Background" Value="LightGreen"/>
                        </Style>
                    </DataGridTextColumn.EditingElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Preview Name"
                                    Binding="{Binding PreviewName}"
                                    Width="*"/>

                <DataGridTextColumn Header="Detail #"
                                    Binding="{Binding DetailNum}"
                                    Width="80"
                                    IsReadOnly="True"/>

                <DataGridTextColumn Header="Sheet #"
                                    Binding="{Binding SheetNumber}"
                                    Width="80"
                                    IsReadOnly="True"/>

            </DataGrid.Columns>

        </DataGrid>

        <!-- Buttons + Duplicate Warning -->
        <StackPanel Orientation="Horizontal" Grid.Row="4" HorizontalAlignment="Right">

            <TextBox x:Name="DuplicatesBox"
                     Width="300"
                     Height="25"
                     IsReadOnly="True"
                     Foreground="Red"
                     BorderBrush="Red"
                     Visibility="Collapsed"
                     Margin="0,0,10,0"/>

            <Button Content="Truncate Last Digit"
                    Click="TruncateLastDigit_Click"
                    Margin="0,0,5,0"/>

            <Button Content="Preview"
                    Click="Preview_Click"
                    Margin="0,0,5,0"/>

            <Button Content="Update"
                    Click="Update_Click"
                    Margin="0,0,5,0"/>

            <Button Content="Close"
                    Click="Close_Click"/>
        </StackPanel>

    </Grid>
</Window>
