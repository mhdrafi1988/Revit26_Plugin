<Window x:Class="Revit22_Plugin.V4_02.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Auto Roof Slope"
        Height="650"
        Width="900"
        WindowStartupLocation="CenterScreen">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Main -->
            <RowDefinition Height="160"/>
            <!-- Log -->
        </Grid.RowDefinitions>

        <!-- ================= HEADER ================= -->
        <StackPanel Orientation="Vertical" Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="{Binding RoofInfo}"
                       FontWeight="Bold"
                       FontSize="14"/>

            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                <TextBlock Text="Slope (%):"
                           VerticalAlignment="Center"
                           Margin="0,0,5,0"/>
                <ComboBox
                            Width="100"
                            IsEditable="True"
                            IsTextSearchEnabled="False"
                            ItemsSource="{Binding SlopePresets}"
                            Text="{Binding SlopeInput, UpdateSourceTrigger=PropertyChanged}"
                            VerticalContentAlignment="Center"
                            Margin="4"/>

                <ComboBox Width="120"
                          Margin="20,0,0,0"
                          ItemsSource="{Binding SizeFilters}"
                          SelectedItem="{Binding SelectedSizeFilter}"/>

                <TextBlock Text="{Binding SelectedDrainsCount}"
                           Margin="20,0,0,0"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </StackPanel>

        <!-- ================= MAIN CONTENT ================= -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- ===== DRAIN LIST ===== -->
            <GroupBox Header="Detected Drains" Grid.Column="0" Margin="0,0,10,0">
                <DataGrid ItemsSource="{Binding AllDrains}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          SelectionMode="Extended">

                    <DataGrid.Columns>
                        <DataGridCheckBoxColumn Header="✔"
                                                Width="40"
                                                Binding="{Binding IsSelected}"/>

                        <DataGridTextColumn Header="Shape"
                                            Binding="{Binding ShapeType}"
                                            Width="*"/>

                        <DataGridTextColumn Header="Size Category"
                                            Binding="{Binding SizeCategory}"
                                            Width="*"/>

                        <DataGridTextColumn Header="Width (mm)"
                                            Binding="{Binding Width, StringFormat=F0}"
                                            Width="*"/>

                        <DataGridTextColumn Header="Height (mm)"
                                            Binding="{Binding Height, StringFormat=F0}"
                                            Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>

            <!-- ===== SLOPE SUMMARY ===== -->
            <GroupBox Header="Slope Summary" Grid.Column="1">
                <StackPanel Margin="10">

                    <TextBlock Text="Vertices Modified:"
                               FontWeight="Bold"/>
                    <TextBlock Text="{Binding VerticesModified}"
                               Margin="0,0,0,8"/>

                    <TextBlock Text="Vertices Skipped:"
                               FontWeight="Bold"/>
                    <TextBlock Text="{Binding VerticesSkipped}"
                               Margin="0,0,0,8"/>

                    <TextBlock Text="Max Elevation (mm):"
                               FontWeight="Bold"/>
                    <TextBlock Text="{Binding MaxElevationMm, StringFormat=F1}"
                               Margin="0,0,0,8"/>

                    <TextBlock Text="Longest Path (m):"
                               FontWeight="Bold"/>
                    <TextBlock Text="{Binding LongestPathMeters, StringFormat=F2}"
                               Margin="0,10,0,0"/>

                    <Button
                            x:Name="ApplyButton"
                            Content="Apply"
                            Width="90"
                            Height="28"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Margin="10"
                            Click="ApplyButton_Click"/>


                    <Button Content="Cancel"
                            Margin="0,5,0,0"
                            Height="28"
                            Command="{Binding CancelCommand}"/>
                </StackPanel>
            </GroupBox>
        </Grid>

        <!-- ================= LOG PANEL ================= -->
        <GroupBox Header="Log" Grid.Row="2" Margin="0,10,0,0">
            <TextBox Text="{Binding LogText}"
                     IsReadOnly="True"
                     TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"/>
        </GroupBox>
    </Grid>
</Window>
